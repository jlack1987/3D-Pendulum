(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     75829,       2195]
NotebookOptionsPosition[     72880,       2102]
NotebookOutlinePosition[     73217,       2117]
CellTagsIndexPosition[     73174,       2114]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["\<\
Author: Jordan Lack
Date: 12-18-2013\
\>", "Section",
 CellChangeTimes->{{3.598035333804228*^9, 3.598035348675071*^9}, {
  3.598038416139*^9, 3.59803841820683*^9}}],

Cell[CellGroupData[{

Cell["\<\
This file works out symbolically the dynamic model of an inverted pendulum.\
\>", "Subsection",
 CellChangeTimes->{{3.596361737034553*^9, 3.596361756281372*^9}}],

Cell["\<\
Note that this notebook requires both Screws.m and RobotLinks.m from Richard \
Murray

http://www.cds.caltech.edu/~murray/books/MLS/ftp/RobotLinks.m ---- RobotLinks.m
http://www.cds.caltech.edu/~murray/books/MLS94/ftp/Screws.m   ---- Screws.m\
\>", "Text",
 CellChangeTimes->{{3.5976888593646183`*^9, 3.597688883255968*^9}, {
   3.5976889293964853`*^9, 3.597688940508602*^9}, {3.5976889744088182`*^9, 
   3.5976889812924957`*^9}, 3.59768960454128*^9, 3.598038425366674*^9}],

Cell[BoxData[
 RowBox[{"<<", "RobotLinks.m", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"import", " ", "functions", " ", "from", " ", 
    RowBox[{"RobotLinks", ".", "m"}]}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.596361804078804*^9, 3.596361807571534*^9}, {
  3.596361910372081*^9, 3.596361928764076*^9}}],

Cell[CellGroupData[{

Cell["Constants:", "Subsubsection",
 CellChangeTimes->{{3.5963619384478416`*^9, 3.596361941142098*^9}}],

Cell[CellGroupData[{

Cell["L :      virtual leg length", "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.5963620972243567`*^9}}],

Cell["m :     overall mass", "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.596362118966242*^9}, {
   3.597870992657342*^9, 3.597870995065773*^9}}],

Cell["\<\
x :      com pos in forward dir.\
\>", "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.596362133295315*^9}}],

Cell["y :      com pos in lateral dir.", "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.596362143186316*^9}}],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["x", "c"], " ", ":"}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 "    cop position in forward dir."
}], "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.596362165278245*^9}}],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   SubscriptBox["y", "c"], TraditionalForm]]],
 " :    cop position in lateral dir."
}], "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.596362175993391*^9}, {
   3.5963925791495647`*^9, 3.596392579154284*^9}, {3.5987107356182327`*^9, 
   3.598710735620097*^9}}],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["p", "x"], "[", "t", "]"}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 ": distance from world frame to body-fixed frame in x-direction"
}], "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.596362175993391*^9}, {
   3.5963925791495647`*^9, 3.596392579154284*^9}, {3.5987107356182327`*^9, 
   3.598710761578973*^9}}],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["p", "y"], "[", "t", "]"}], TraditionalForm]]],
 ": distance from world frame to body-fixed frame in x-direction"
}], "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.596362175993391*^9}, {
   3.5963925791495647`*^9, 3.596392579154284*^9}, {3.5987107356182327`*^9, 
   3.5987107660035763`*^9}}],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["p", "z"], "[", "t", "]"}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 ": distance from world frame to body-fixed frame in x-direction"
}], "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.596362175993391*^9}, {
   3.5963925791495647`*^9, 3.596392579154284*^9}, {3.5987107356182327`*^9, 
   3.598710768990985*^9}}],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["q", "1"], "[", "t", "]"}], TraditionalForm]]],
 " : ankle roll"
}], "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.596362175993391*^9}, {
   3.5963925791495647`*^9, 3.596392591930319*^9}}],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["q", "2"], "[", "t", "]"}], TraditionalForm]]],
 " : ankle pitch"
}], "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.596362175993391*^9}, {
   3.5963925791495647`*^9, 3.5963926015221357`*^9}}],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["q", "3"], "[", "t", "]"}], TraditionalForm]]],
 " : leg extension"
}], "Item",
 CellChangeTimes->{
  3.596361898276828*^9, 3.596361932209374*^9, {3.596362020454558*^9, 
   3.596362024017866*^9}, {3.596362057972962*^9, 3.596362175993391*^9}, {
   3.5963925791495647`*^9, 3.596392613246167*^9}}]
}, Open  ]]
}, Open  ]],

Cell["Parallel simplification", "Subsubsection",
 CellChangeTimes->{{3.525444424954421*^9, 3.525444430793755*^9}}],

Cell[CellGroupData[{

Cell["Parallel simplification", "Subsubsection",
 CellChangeTimes->{{3.525444424954421*^9, 3.525444430793755*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ParallelSimplify", "[", 
   RowBox[{"A_", "?", "MatrixQ"}], "]"}], ":=", 
  RowBox[{"ParallelTable", "[", 
   RowBox[{
    RowBox[{"Simplify", "[", 
     RowBox[{"A", "\[LeftDoubleBracket]", 
      RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{
       RowBox[{"Dimensions", "[", "A", "]"}], "\[LeftDoubleBracket]", "1", 
       "\[RightDoubleBracket]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", 
      RowBox[{
       RowBox[{"Dimensions", "[", "A", "]"}], "\[LeftDoubleBracket]", "2", 
       "\[RightDoubleBracket]"}]}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.525444031603923*^9, 3.525444057323394*^9}, 
   3.525444167371688*^9, {3.5254442077009945`*^9, 3.5254442142373686`*^9}, {
   3.5254442656763105`*^9, 3.52544431862834*^9}, {3.5254446389836626`*^9, 
   3.525444643198904*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ParallelSimplify", "[", 
   RowBox[{"A_", "?", "VectorQ"}], "]"}], ":=", 
  RowBox[{"ParallelTable", "[", 
   RowBox[{
    RowBox[{"Simplify", "[", 
     RowBox[{"A", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
     "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"Length", "[", "A", "]"}]}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.5254713763319516`*^9, 3.525471396675115*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ParallelSimplify", "[", "A_", "]"}], ":=", 
  RowBox[{"Simplify", "[", "A", "]"}]}]], "Input",
 CellChangeTimes->{{3.5254715146968656`*^9, 3.525471527826617*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nBaseDof", " ", "=", " ", "6"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ndof", " ", "=", " ", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"consts", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"L", "\[Rule]", 
      RowBox[{"1", "/", "1"}]}], ",", " ", 
     RowBox[{"mf", "\[Rule]", 
      FractionBox["1", "10"]}], ",", 
     RowBox[{"m", "\[Rule]", 
      FractionBox["1150", "10"]}], ",", " ", 
     RowBox[{"g", "\[Rule]", 
      FractionBox["981", "100"]}], ",", 
     RowBox[{"ha", "\[Rule]", 
      FractionBox["1", "100"]}], ",", 
     RowBox[{"wfoot", "\[Rule]", 
      FractionBox["3", "100"]}], ",", 
     RowBox[{"ltoe", "\[Rule]", 
      FractionBox["8", "100"]}], ",", 
     RowBox[{"lheel", "\[Rule]", 
      FractionBox["3", "100"]}]}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.596362220014406*^9, 3.596362278493443*^9}, {
   3.5963923610031157`*^9, 3.596392365436727*^9}, {3.596392451348113*^9, 
   3.596392456957798*^9}, 3.597870767671503*^9, 3.597870989279255*^9, {
   3.598034924604807*^9, 3.598034932680544*^9}, {3.598035023269052*^9, 
   3.598035023340125*^9}, {3.598035311499398*^9, 3.59803531163339*^9}, {
   3.598093955158259*^9, 3.598093955243552*^9}, 3.5980947132176247`*^9, {
   3.598094815942137*^9, 3.598094816037753*^9}, {3.5982138729607143`*^9, 
   3.598213888654551*^9}, 3.598710779728557*^9, {3.598710954569268*^9, 
   3.598710961592696*^9}, {3.598711007576079*^9, 3.598711055785451*^9}, {
   3.5987115793619003`*^9, 3.598711584775972*^9}, {3.598711870346843*^9, 
   3.5987118705853662`*^9}, 3.598718612494803*^9, {3.5987223547605743`*^9, 
   3.598722356846796*^9}, {3.598722401871952*^9, 3.598722414207596*^9}, {
   3.598725064185527*^9, 3.598725067711472*^9}, {3.598784539950842*^9, 
   3.59878457554315*^9}, {3.59878575712637*^9, 3.5987857677522583`*^9}, {
   3.59878580671992*^9, 3.598785814351514*^9}, {3.598787671737473*^9, 
   3.598787672962487*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"mVec", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"mf", ",", "m"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.598711595428763*^9, 3.59871161498335*^9}}],

Cell[BoxData[
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{"ndof", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", "\t", 
   RowBox[{
    RowBox[{"statesubs", "=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           SubscriptBox["p", "x"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "1", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SubscriptBox["p", "y"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "2", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SubscriptBox["p", "z"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "3", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[Phi]", "x"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "4", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "5", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[Phi]", "z"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "6", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["p", "x"], "\[Prime]"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "10", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["p", "y"], "\[Prime]"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "11", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["p", "z"], "\[Prime]"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "12", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[Phi]", "x"], "\[Prime]"], "[", "t", "]"}], 
          "\[Rule]", 
          RowBox[{"x", "[", "13", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[Phi]", "y"], "\[Prime]"], "[", "t", "]"}], 
          "\[Rule]", 
          RowBox[{"x", "[", "14", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[Phi]", "z"], "\[Prime]"], "[", "t", "]"}], 
          "\[Rule]", 
          RowBox[{"x", "[", "15", "]"}]}]}], "}"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           SubscriptBox["q", "i"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", 
           RowBox[{"i", "+", "nBaseDof"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "ndof"}], "}"}]}], "]"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["q", "i"], "\[Prime]"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", 
           RowBox[{"i", "+", 
            RowBox[{"2", "*", "nBaseDof"}], "+", "ndof"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "ndof"}], "}"}]}], "]"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", "\t", 
   RowBox[{
    RowBox[{"statesubs", "=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           SubscriptBox["p", "x"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "1", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SubscriptBox["p", "y"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "2", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SubscriptBox["p", "z"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "3", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[Phi]", "x"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "4", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "5", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SubscriptBox["\[Phi]", "z"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "6", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["p", "x"], "\[Prime]"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "9", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["p", "y"], "\[Prime]"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "10", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["p", "z"], "\[Prime]"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", "11", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[Phi]", "x"], "\[Prime]"], "[", "t", "]"}], 
          "\[Rule]", 
          RowBox[{"x", "[", "12", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[Phi]", "y"], "\[Prime]"], "[", "t", "]"}], 
          "\[Rule]", 
          RowBox[{"x", "[", "13", "]"}]}], ",", 
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["\[Phi]", "z"], "\[Prime]"], "[", "t", "]"}], 
          "\[Rule]", 
          RowBox[{"x", "[", "14", "]"}]}]}], "}"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           SubscriptBox["q", "i"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", 
           RowBox[{"i", "+", "nBaseDof"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "ndof"}], "}"}]}], "]"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           SuperscriptBox[
            SubscriptBox["q", "i"], "\[Prime]"], "[", "t", "]"}], "\[Rule]", 
          RowBox[{"x", "[", 
           RowBox[{"i", "+", 
            RowBox[{"2", "*", "nBaseDof"}], "+", "ndof"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "ndof"}], "}"}]}], "]"}]}], "]"}]}], 
    ";"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.5987244091159277`*^9, 3.598724415106564*^9}, {
  3.598724568203504*^9, 3.5987246162331657`*^9}}],

Cell[CellGroupData[{

Cell[BoxData["statesubs"], "Input",
 CellChangeTimes->{{3.59872432507577*^9, 3.598724326336194*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{
     SubscriptBox["p", "x"], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "1", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["p", "y"], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "2", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["p", "z"], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "3", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[Phi]", "x"], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "4", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "5", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[Phi]", "z"], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "6", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["p", "x"], "\[Prime]",
      MultilineFunction->None], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "10", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["p", "y"], "\[Prime]",
      MultilineFunction->None], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "11", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["p", "z"], "\[Prime]",
      MultilineFunction->None], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "12", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["\[Phi]", "x"], "\[Prime]",
      MultilineFunction->None], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "13", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["\[Phi]", "y"], "\[Prime]",
      MultilineFunction->None], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "14", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["\[Phi]", "z"], "\[Prime]",
      MultilineFunction->None], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "15", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["q", "1"], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "7", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["q", "2"], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "8", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["q", "3"], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "9", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["q", "1"], "\[Prime]",
      MultilineFunction->None], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "16", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["q", "2"], "\[Prime]",
      MultilineFunction->None], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "17", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      SubscriptBox["q", "3"], "\[Prime]",
      MultilineFunction->None], "[", "t", "]"}], "\[Rule]", 
    RowBox[{"x", "[", "18", "]"}]}]}], "}"}]], "Output",
 CellChangeTimes->{3.59872432767907*^9, 3.5987246280200253`*^9, 
  3.598725076402421*^9, 3.598725357419553*^9, 3.5987255804149303`*^9, 
  3.598726927862514*^9, 3.598728376772688*^9, 3.598732873463708*^9, 
  3.598781052656413*^9, 3.598784791054347*^9, 3.598785217348035*^9, 
  3.598785821733059*^9, 3.598787681425308*^9, 3.598788963955099*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   SubscriptBox["\[Xi]", "0"], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["\[Xi]", "px"], "=", 
   RowBox[{"PrismaticTwist", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   SubscriptBox["\[Xi]", "py"], "=", 
   RowBox[{"PrismaticTwist", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["\[Xi]", "pz"], "=", 
   RowBox[{"PrismaticTwist", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["\[Xi]", "\[Phi]x"], "=", 
   RowBox[{"RevoluteTwist", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["\[Xi]", "\[Phi]y"], "=", 
   RowBox[{"RevoluteTwist", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["\[Xi]", "\[Phi]z"], "=", 
   RowBox[{"RevoluteTwist", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["\[Xi]", "q1"], "=", 
   RowBox[{"RevoluteTwist", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "ha"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   SubscriptBox["\[Xi]", "q2"], "=", 
   RowBox[{"RevoluteTwist", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "ha"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["\[Xi]", "q3"], "=", 
   RowBox[{"PrismaticTwist", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", 
       RowBox[{"ha", "+", 
        FractionBox["L", "2"]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[ScriptCapitalQ]", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["p", "x"], "[", "t", "]"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["p", "y"], "[", "t", "]"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["p", "z"], "[", "t", "]"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Phi]", "x"], "[", "t", "]"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Phi]", "z"], "[", "t", "]"}], "}"}]}], "}"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["q", "i"], "[", "t", "]"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "ndof"}], "}"}]}], "]"}], ",", "1"}], 
     "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   OverscriptBox["\[ScriptCapitalQ]", "."], " ", "=", " ", 
   RowBox[{
    SubscriptBox["\[PartialD]", "t"], "\[ScriptCapitalQ]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.596362393697674*^9, 3.5963625489852457`*^9}, {
   3.5963626127623463`*^9, 3.596362683781125*^9}, {3.596363017673491*^9, 
   3.596363043689909*^9}, {3.596363270559202*^9, 3.596363271814651*^9}, {
   3.5963633077726593`*^9, 3.596363350255663*^9}, {3.5963921478439417`*^9, 
   3.596392184406311*^9}, {3.596392625566255*^9, 3.596392631846089*^9}, {
   3.596392663974062*^9, 3.596392712380848*^9}, {3.596392755676669*^9, 
   3.5963927777747297`*^9}, {3.597515524302251*^9, 3.5975155290921373`*^9}, {
   3.598032676765966*^9, 3.5980326994258633`*^9}, {3.598032760309804*^9, 
   3.598032767218986*^9}, {3.598032801679843*^9, 3.598032824103406*^9}, 
   3.5980333647728367`*^9, {3.598033724671924*^9, 3.5980337275918818`*^9}, {
   3.598034918506914*^9, 3.598034920022759*^9}, 3.598039836079295*^9, {
   3.598115888846877*^9, 3.5981158897002068`*^9}, {3.5981161164142*^9, 
   3.5981161197999907`*^9}, {3.59871080366506*^9, 3.598710922463559*^9}, {
   3.59871114885732*^9, 3.5987112080004253`*^9}, {3.598711250934272*^9, 
   3.598711287553996*^9}, {3.598711892038067*^9, 3.598711900086506*^9}, {
   3.598716032474029*^9, 3.598716042399314*^9}, {3.598716355488226*^9, 
   3.598716378672172*^9}, {3.598716491676619*^9, 3.5987165379524612`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "1"], "[", "0", "]"}], " ", "=", " ", 
   RowBox[{"RPToHomogeneous", "[", 
    RowBox[{
     RowBox[{"IdentityMatrix", "[", "3", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", 
       FractionBox["ha", "2"]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "foot"], "[", "0", "]"}], " ", "=", " ", 
   RowBox[{"RPToHomogeneous", "[", 
    RowBox[{
     RowBox[{"IdentityMatrix", "[", "3", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "ha"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "ToeL"], "[", "0", "]"}], " ", "=", " ", 
   RowBox[{"RPToHomogeneous", "[", 
    RowBox[{
     RowBox[{"IdentityMatrix", "[", "3", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"ltoe", ",", "wfoot", ",", "0"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "ToeR"], "[", "0", "]"}], " ", "=", " ", 
   RowBox[{"RPToHomogeneous", "[", 
    RowBox[{
     RowBox[{"IdentityMatrix", "[", "3", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"ltoe", ",", 
       RowBox[{"-", "wfoot"}], ",", "0"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "HeelL"], "[", "0", "]"}], " ", "=", " ", 
   RowBox[{"RPToHomogeneous", "[", 
    RowBox[{
     RowBox[{"IdentityMatrix", "[", "3", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "lheel"}], ",", "wfoot", ",", "0"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "HeelR"], "[", "0", "]"}], " ", "=", " ", 
   RowBox[{"RPToHomogeneous", "[", 
    RowBox[{
     RowBox[{"IdentityMatrix", "[", "3", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "lheel"}], ",", 
       RowBox[{"-", "wfoot"}], ",", "0"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "2"], "[", "0", "]"}], " ", "=", " ", 
   RowBox[{"RPToHomogeneous", "[", 
    RowBox[{
     RowBox[{"IdentityMatrix", "[", "3", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", 
       RowBox[{"ha", "+", "L"}]}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.59811621136276*^9, 3.598116229020769*^9}, {
  3.5987112929921007`*^9, 3.59871132469989*^9}, {3.5987256854805183`*^9, 
  3.598725693965239*^9}, {3.598784435752428*^9, 3.598784534468278*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "foot"], "[", "q", "]"}], " ", "=", " ", 
   RowBox[{"ParallelSimplify", "[", 
    RowBox[{"ForwardKinematics", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "px"], ",", 
        RowBox[{
         SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "py"], ",", 
        RowBox[{
         SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "pz"], ",", 
        RowBox[{
         SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{
       SubscriptBox["g", "foot"], "[", "0", "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "ToeL"], "[", "q", "]"}], " ", "=", " ", 
   RowBox[{"ParallelSimplify", "[", 
    RowBox[{"ForwardKinematics", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "px"], ",", 
        RowBox[{
         SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "py"], ",", 
        RowBox[{
         SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "pz"], ",", 
        RowBox[{
         SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{
       SubscriptBox["g", "ToeL"], "[", "0", "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "ToeR"], "[", "q", "]"}], " ", "=", " ", 
   RowBox[{"ParallelSimplify", "[", 
    RowBox[{"ForwardKinematics", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "px"], ",", 
        RowBox[{
         SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "py"], ",", 
        RowBox[{
         SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "pz"], ",", 
        RowBox[{
         SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{
       SubscriptBox["g", "ToeR"], "[", "0", "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "HeelL"], "[", "q", "]"}], " ", "=", " ", 
   RowBox[{"ParallelSimplify", "[", 
    RowBox[{"ForwardKinematics", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "px"], ",", 
        RowBox[{
         SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "py"], ",", 
        RowBox[{
         SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "pz"], ",", 
        RowBox[{
         SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{
       SubscriptBox["g", "HeelL"], "[", "0", "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox["g", "HeelR"], "[", "q", "]"}], " ", "=", " ", 
   RowBox[{"ParallelSimplify", "[", 
    RowBox[{"ForwardKinematics", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "px"], ",", 
        RowBox[{
         SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "py"], ",", 
        RowBox[{
         SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "pz"], ",", 
        RowBox[{
         SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
        RowBox[{
         SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{
       SubscriptBox["g", "HeelR"], "[", "0", "]"}]}], "]"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.598784587138833*^9, 3.598784628340611*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"ndof", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["g", "1"], "[", "q", "]"}], " ", "=", " ", 
      RowBox[{"ParallelSimplify", "[", 
       RowBox[{"ForwardKinematics", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "px"], ",", 
           RowBox[{
            SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "py"], ",", 
           RowBox[{
            SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "pz"], ",", 
           RowBox[{
            SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{
          SubscriptBox["g", "1"], "[", "0", "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{
       SubscriptBox["g", "2"], "[", "q", "]"}], " ", "=", " ", 
      RowBox[{"ParallelSimplify", "[", 
       RowBox[{"ForwardKinematics", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "px"], ",", 
           RowBox[{
            SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "py"], ",", 
           RowBox[{
            SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "pz"], ",", 
           RowBox[{
            SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "q1"], ",", 
           RowBox[{
            SubscriptBox["q", "1"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "q2"], ",", 
           RowBox[{
            SubscriptBox["q", "2"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "q3"], ",", 
           RowBox[{
            SubscriptBox["q", "3"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{
          SubscriptBox["g", "2"], "[", "0", "]"}]}], "]"}], "]"}]}], ";"}], 
    "\[IndentingNewLine]", "\t", ",", "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{
       SubscriptBox["g", "1"], "[", "q", "]"}], " ", "=", " ", 
      RowBox[{"ParallelSimplify", "[", 
       RowBox[{"ForwardKinematics", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "px"], ",", 
           RowBox[{
            SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "py"], ",", 
           RowBox[{
            SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "pz"], ",", 
           RowBox[{
            SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{
          SubscriptBox["g", "1"], "[", "0", "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{
       SubscriptBox["g", "2"], "[", "q", "]"}], " ", "=", " ", 
      RowBox[{"ParallelSimplify", "[", 
       RowBox[{"ForwardKinematics", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "px"], ",", 
           RowBox[{
            SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "py"], ",", 
           RowBox[{
            SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "pz"], ",", 
           RowBox[{
            SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
           RowBox[{
            SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "q1"], ",", 
           RowBox[{
            SubscriptBox["q", "1"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Xi]", "q2"], ",", 
           RowBox[{
            SubscriptBox["q", "2"], "[", "t", "]"}]}], "}"}], ",", 
         RowBox[{
          SubscriptBox["g", "2"], "[", "0", "]"}]}], "]"}], "]"}]}], ";"}]}], 
   "\[IndentingNewLine]", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.598035262060305*^9, 3.59803528500876*^9}, {
  3.5987113394665737`*^9, 3.5987115334295807`*^9}, {3.598711739919992*^9, 
  3.598711829622814*^9}, {3.598716410313635*^9, 3.598716410343337*^9}, {
  3.5987257051497793`*^9, 3.598725716612767*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"footpts", " ", "=", " ", 
   RowBox[{"Transpose", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        SubscriptBox["g", "ToeL"], "[", "q", "]"}], ",", 
       RowBox[{
        SubscriptBox["g", "ToeR"], "[", "q", "]"}], ",", 
       RowBox[{
        SubscriptBox["g", "HeelR"], "[", "q", "]"}], ",", 
       RowBox[{
        SubscriptBox["g", "HeelL"], "[", "q", "]"}], ",", 
       RowBox[{
        SubscriptBox["g", "ToeL"], "[", "q", "]"}]}], "}"}], 
     "\[LeftDoubleBracket]", 
     RowBox[{
      RowBox[{"1", ";;", "All"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", "4"}], 
     "\[RightDoubleBracket]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.5987846529227962`*^9, 3.598784698405365*^9}, {
  3.598784734342368*^9, 3.598784738789892*^9}, {3.5987847716704197`*^9, 
  3.598784780742557*^9}, {3.59878495700631*^9, 3.598784970095861*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"jpos", " ", "=", " ", 
   RowBox[{"Transpose", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        SubscriptBox["g", "foot"], "[", "q", "]"}], ",", 
       RowBox[{
        SubscriptBox["g", "2"], "[", "q", "]"}]}], "}"}], 
     "\[LeftDoubleBracket]", 
     RowBox[{
      RowBox[{"1", ";;", "All"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", "4"}], 
     "\[RightDoubleBracket]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.598784012275017*^9, 3.598784014752016*^9}, {
  3.598784098321636*^9, 3.598784122651058*^9}, {3.598784863683917*^9, 
  3.598784866676691*^9}, {3.598784979820264*^9, 3.598784980030546*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"pCoM", "=", 
   RowBox[{"ParallelSimplify", "[", 
    FractionBox[
     RowBox[{
      UnderoverscriptBox["\[Sum]", 
       RowBox[{"i", "=", "1"}], 
       RowBox[{"Length", "[", "mVec", "]"}]], 
      RowBox[{
       RowBox[{
        RowBox[{
         SubscriptBox["g", "i"], "[", "q", "]"}], "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", "3"}], ",", "4"}], "\[RightDoubleBracket]"}], "*", 
       RowBox[{
       "mVec", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}], 
     RowBox[{"Total", "[", "mVec", "]"}]], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.5987841611813927`*^9, 3.5987841927413797`*^9}, {
  3.598784223336899*^9, 3.598784227700914*^9}, {3.598784258125989*^9, 
  3.5987843017088213`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"JCoM", " ", "=", " ", 
   RowBox[{
    SubscriptBox["\[PartialD]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Flatten", "[", "\[ScriptCapitalQ]", "]"}], ",", "1"}], "}"}]],
     "pCoM"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.5987889045189333`*^9, 3.598788954697345*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"ndof", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[ScriptCapitalJ]", "1"], "=", 
      RowBox[{"BodyJacobian", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "px"], ",", 
          RowBox[{
           SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "py"], ",", 
          RowBox[{
           SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "pz"], ",", 
          RowBox[{
           SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "0"], ",", 
          RowBox[{
           SubscriptBox["q", "1"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "0"], ",", 
          RowBox[{
           SubscriptBox["q", "2"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "0"], ",", 
          RowBox[{
           SubscriptBox["q", "3"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{
         SubscriptBox["g", "1"], "[", "0", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      SubscriptBox["\[ScriptCapitalJ]", "2"], "=", 
      RowBox[{"BodyJacobian", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "px"], ",", 
          RowBox[{
           SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "py"], ",", 
          RowBox[{
           SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "pz"], ",", 
          RowBox[{
           SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "q1"], ",", 
          RowBox[{
           SubscriptBox["q", "1"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "q2"], ",", 
          RowBox[{
           SubscriptBox["q", "2"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "q3"], ",", 
          RowBox[{
           SubscriptBox["q", "3"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{
         SubscriptBox["g", "2"], "[", "0", "]"}]}], "]"}]}], ";"}], 
    "\[IndentingNewLine]", ",", "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[ScriptCapitalJ]", "1"], "=", 
      RowBox[{"BodyJacobian", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "px"], ",", 
          RowBox[{
           SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "py"], ",", 
          RowBox[{
           SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "pz"], ",", 
          RowBox[{
           SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "0"], ",", 
          RowBox[{
           SubscriptBox["q", "1"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "0"], ",", 
          RowBox[{
           SubscriptBox["q", "2"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{
         SubscriptBox["g", "1"], "[", "0", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      SubscriptBox["\[ScriptCapitalJ]", "2"], "=", 
      RowBox[{"BodyJacobian", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "px"], ",", 
          RowBox[{
           SubscriptBox["p", "x"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "py"], ",", 
          RowBox[{
           SubscriptBox["p", "y"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "pz"], ",", 
          RowBox[{
           SubscriptBox["p", "z"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]x"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "x"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]y"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "y"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "\[Phi]z"], ",", 
          RowBox[{
           SubscriptBox["\[Phi]", "z"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "q1"], ",", 
          RowBox[{
           SubscriptBox["q", "1"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["\[Xi]", "q2"], ",", 
          RowBox[{
           SubscriptBox["q", "2"], "[", "t", "]"}]}], "}"}], ",", 
        RowBox[{
         SubscriptBox["g", "2"], "[", "0", "]"}]}], "]"}]}], ";"}]}], 
   "\[IndentingNewLine]", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.596363059312772*^9, 3.596363154391695*^9}, 
   3.596363372570903*^9, {3.596363421033819*^9, 3.596363443445915*^9}, {
   3.596363596774487*^9, 3.596363614020338*^9}, {3.596363672004499*^9, 
   3.5963636729795837`*^9}, {3.596392296570682*^9, 3.596392311844554*^9}, {
   3.5980347078802147`*^9, 3.598034721933799*^9}, {3.598035045383028*^9, 
   3.598035055413945*^9}, {3.598035168226728*^9, 3.598035239056156*^9}, {
   3.5987119791620417`*^9, 3.598712000393016*^9}, {3.598712033727026*^9, 
   3.598712113484645*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   SubscriptBox["\[ScriptCapitalI]", "1"], " ", "=", 
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {
        RowBox[{"1", "/", "10000"}], "0", "0"},
       {"0", 
        RowBox[{"1", "/", "10000"}], "0"},
       {"0", "0", 
        RowBox[{"1", "/", "10000"}]}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["\[ScriptCapitalI]", "2"], " ", "=", 
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {
        RowBox[{"1", "/", "100"}], "0", "0"},
       {"0", 
        RowBox[{"1", "/", "100"}], "0"},
       {"0", "0", 
        RowBox[{"1", "/", "100"}]}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]]}], ";"}]}], "Input",
 CellChangeTimes->{{3.596363677989197*^9, 3.596363764060768*^9}, {
  3.596392378608533*^9, 3.596392388379656*^9}, {3.597871178827078*^9, 
  3.597871187048465*^9}, {3.598712139661668*^9, 3.598712303138214*^9}, {
  3.59871237787648*^9, 3.598712377947068*^9}, {3.598725320314055*^9, 
  3.59872534894414*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"i", "=", "1"}], ",", 
    RowBox[{"i", "\[LessEqual]", 
     RowBox[{"Length", "[", "mVec", "]"}]}], ",", 
    RowBox[{"i", "++"}], ",", 
    RowBox[{
     SubscriptBox["\[ScriptCapitalM]", "i"], "=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
          "mVec", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "*", 
          RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ",", 
         RowBox[{"Table", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", "3", "}"}], ",", 
           RowBox[{"{", "3", "}"}]}], "]"}], ",", "2"}], "]"}], ",", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", "3", "}"}], ",", 
           RowBox[{"{", "3", "}"}]}], "]"}], ",", 
         SubscriptBox["\[ScriptCapitalI]", "i"], ",", "2"}], "]"}], ",", 
       "1"}], "]"}]}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.596363818230938*^9, 3.596364000303225*^9}, {
  3.598711665125098*^9, 3.598711665825383*^9}, {3.59871232530831*^9, 
  3.598712368591137*^9}, {3.5987162340977907`*^9, 3.598716261985594*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"q0subs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
      "\[ScriptCapitalQ]", "\[LeftDoubleBracket]", "i", 
       "\[RightDoubleBracket]"}], "\[Rule]", "0"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "\[ScriptCapitalQ]", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.598722157698267*^9, 3.598722208645767*^9}}],

Cell[CellGroupData[{

Cell[BoxData["q0subs"], "Input",
 CellChangeTimes->{{3.598725129551991*^9, 3.598725130468251*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{
     SubscriptBox["p", "x"], "[", "t", "]"}], "\[Rule]", "0"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["p", "y"], "[", "t", "]"}], "\[Rule]", "0"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["p", "z"], "[", "t", "]"}], "\[Rule]", "0"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[Phi]", "x"], "[", "t", "]"}], "\[Rule]", "0"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "\[Rule]", "0"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[Phi]", "z"], "[", "t", "]"}], "\[Rule]", "0"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["q", "1"], "[", "t", "]"}], "\[Rule]", "0"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["q", "2"], "[", "t", "]"}], "\[Rule]", "0"}], ",", 
   RowBox[{
    RowBox[{
     SubscriptBox["q", "3"], "[", "t", "]"}], "\[Rule]", "0"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.598725135883444*^9, 3.5987253633571253`*^9, 
  3.598725586253701*^9, 3.598726933637937*^9, 3.5987283826490107`*^9, 
  3.5987328788762827`*^9, 3.598781058114191*^9, 3.598784800381558*^9, 
  3.598785226203548*^9, 3.5987858306740026`*^9, 3.598787694058082*^9, 
  3.598788976342552*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[ScriptCapitalD]", " ", "=", " ", 
   RowBox[{"ParallelSimplify", "[", 
    RowBox[{
     UnderoverscriptBox["\[Sum]", 
      RowBox[{"i", "=", "1"}], 
      RowBox[{"Length", "[", "mVec", "]"}]], 
     RowBox[{
      RowBox[{"Transpose", "[", 
       SubscriptBox["\[ScriptCapitalJ]", "i"], "]"}], ".", 
      SubscriptBox["\[ScriptCapitalM]", "i"], ".", 
      SubscriptBox["\[ScriptCapitalJ]", "i"]}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.596364075446842*^9, 3.596364122951674*^9}, {
   3.596821789616431*^9, 3.596821792353034*^9}, {3.598712403103417*^9, 
   3.598712408081546*^9}, {3.598712463041628*^9, 3.5987124637773533`*^9}, 
   3.598716410345097*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"V", "=", 
   RowBox[{"g", "*", 
    RowBox[{
     UnderoverscriptBox["\[Sum]", 
      RowBox[{"i", "=", "1"}], 
      RowBox[{"Length", "[", "mVec", "]"}]], 
     RowBox[{
      RowBox[{"mVec", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
      "*", 
      RowBox[{
       RowBox[{
        SubscriptBox["g", "i"], "[", "q", "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"3", ",", "4"}], "\[RightDoubleBracket]"}]}]}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.596392470109907*^9, 3.59639251824755*^9}, 
   3.5963925487037573`*^9, {3.598038530928192*^9, 3.598038548592499*^9}, 
   3.598038578894477*^9, {3.598039895120829*^9, 3.598039895369735*^9}, {
   3.5987124399200068`*^9, 3.598712472753875*^9}, 3.598720575269354*^9, {
   3.59873340709702*^9, 3.5987334370888977`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[ScriptCapitalG]", "=", 
   RowBox[{
    SubscriptBox["\[PartialD]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Flatten", "[", "\[ScriptCapitalQ]", "]"}], ",", "1"}], "}"}]],
     "V"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.59639255278366*^9, 3.596392570101184*^9}, 
   3.5963927337547903`*^9, {3.598033338317515*^9, 3.5980333443910217`*^9}, 
   3.5980385818191032`*^9, 3.598093987698078*^9, {3.598732791375053*^9, 
   3.598732797815083*^9}, {3.598732845903462*^9, 3.5987328482401047`*^9}, {
   3.598733326767522*^9, 3.598733377303858*^9}, {3.598733652833395*^9, 
   3.598733669086946*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[ScriptCapitalC]", "=", 
   RowBox[{"InertiaToCoriolis", "[", 
    RowBox[{"\[ScriptCapitalD]", ",", 
     RowBox[{"Flatten", "[", "\[ScriptCapitalQ]", "]"}], ",", 
     RowBox[{"Flatten", "[", 
      OverscriptBox["\[ScriptCapitalQ]", "."], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.596392783593564*^9, 3.596392838330636*^9}, 
   3.5963940715942297`*^9, 3.59639497208928*^9, 3.596821796603281*^9, 
   3.598716410352466*^9, 3.598716455256003*^9, {3.598716591649528*^9, 
   3.5987165929239807`*^9}, {3.598718253920353*^9, 3.598718257513021*^9}, {
   3.598725545652684*^9, 3.5987255468358107`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"ndof", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", 
    RowBox[{"SetDirectory", "[", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<build\>\""}], "]"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{"SetDirectory", "[", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<build_2dof\>\""}], 
     "]"}], ","}], "\[IndentingNewLine]", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.596394444250784*^9, 3.596394450263318*^9}, {
   3.596821908853507*^9, 3.596821912311689*^9}, 3.59769038607752*^9, {
   3.598094754882641*^9, 3.598094804405938*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Jacobian of foot for Lagrange Multipliers\
\>", "Subsection",
 CellChangeTimes->{{3.598725638720787*^9, 3.598725651400573*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CrossProd", "[", "\[CapitalOmega]_", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[CapitalOmega]", "\[LeftDoubleBracket]", 
      RowBox[{"3", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
     RowBox[{"\[CapitalOmega]", "\[LeftDoubleBracket]", 
      RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
     RowBox[{"\[CapitalOmega]", "\[LeftDoubleBracket]", 
      RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], "}"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   SubscriptBox["R", "foot"], "=", 
   RowBox[{"RigidOrientation", "[", 
    RowBox[{
     SubscriptBox["g", "foot"], "[", "q", "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.598725653593606*^9, 3.5987256570836773`*^9}, {
  3.598727070447358*^9, 3.5987270821540403`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   SubscriptBox["p", "foot"], "=", 
   RowBox[{"RigidPosition", "[", 
    RowBox[{
     SubscriptBox["g", "foot"], "[", "q", "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.5987270851348667`*^9, 3.598727095939211*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   SubscriptBox["\[Omega]", "foot"], "=", 
   RowBox[{"CrossProd", "[", 
    RowBox[{"ParallelSimplify", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       SubscriptBox["R", "foot"], "]"}], ".", 
      RowBox[{
       SubscriptBox["\[PartialD]", "t"], 
       SubscriptBox["R", "foot"]}]}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.598727155095783*^9, 3.598727170607687*^9}, {
  3.598727351534021*^9, 3.598727351932848*^9}, {3.598727491863826*^9, 
  3.5987274939412937`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   SubscriptBox["J", "foot"], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[PartialD]", 
       RowBox[{"{", 
        RowBox[{"Flatten", "[", "\[ScriptCapitalQ]", "]"}], "}"}]], 
      SubscriptBox["p", "foot"]}], ",", 
     RowBox[{
      SubscriptBox["\[PartialD]", 
       RowBox[{"{", 
        RowBox[{"Flatten", "[", 
         OverscriptBox["\[ScriptCapitalQ]", "."], "]"}], "}"}]], 
      SubscriptBox["\[Omega]", "foot"]}], ",", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox[
    OverscriptBox["J", "."], "foot"], "=", 
   RowBox[{
    SubscriptBox["\[PartialD]", "t"], 
    SubscriptBox["J", "foot"]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.598727206903751*^9, 3.598727240480315*^9}, {
  3.598727389676544*^9, 3.5987273935617037`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  SubscriptBox["J", "foot"], "//", "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.598727247131518*^9, 3.598727250416152*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"1", "0", "0", "0", 
      RowBox[{"ha", " ", 
       RowBox[{"Cos", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "]"}]}], "0", "0", "0",
       "0"},
     {"0", "1", "0", 
      RowBox[{
       RowBox[{"-", "ha"}], " ", 
       RowBox[{"Cos", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "x"], "[", "t", "]"}], "]"}], " ", 
       RowBox[{"Cos", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "]"}]}], 
      RowBox[{"ha", " ", 
       RowBox[{"Sin", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "x"], "[", "t", "]"}], "]"}], " ", 
       RowBox[{"Sin", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "]"}]}], "0", "0", "0",
       "0"},
     {"0", "0", "1", 
      RowBox[{
       RowBox[{"-", "ha"}], " ", 
       RowBox[{"Cos", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "]"}], " ", 
       RowBox[{"Sin", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "x"], "[", "t", "]"}], "]"}]}], 
      RowBox[{
       RowBox[{"-", "ha"}], " ", 
       RowBox[{"Cos", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "x"], "[", "t", "]"}], "]"}], " ", 
       RowBox[{"Sin", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "]"}]}], "0", "0", "0",
       "0"},
     {"0", "0", "0", 
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "]"}], " ", 
       RowBox[{"Cos", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "z"], "[", "t", "]"}], "]"}]}], 
      RowBox[{"Sin", "[", 
       RowBox[{
        SubscriptBox["\[Phi]", "z"], "[", "t", "]"}], "]"}], "0", "0", "0", 
      "0"},
     {"0", "0", "0", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"Cos", "[", 
         RowBox[{
          SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "]"}]}], " ", 
       RowBox[{"Sin", "[", 
        RowBox[{
         SubscriptBox["\[Phi]", "z"], "[", "t", "]"}], "]"}]}], 
      RowBox[{"Cos", "[", 
       RowBox[{
        SubscriptBox["\[Phi]", "z"], "[", "t", "]"}], "]"}], "0", "0", "0", 
      "0"},
     {"0", "0", "0", 
      RowBox[{"Sin", "[", 
       RowBox[{
        SubscriptBox["\[Phi]", "y"], "[", "t", "]"}], "]"}], "0", "1", "0", 
      "0", "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.5987272509312057`*^9, 3.598727359425943*^9, 
  3.598727395392049*^9, 3.5987284303649397`*^9, 3.598732925795714*^9, 
  3.598781106218478*^9, 3.59878484919606*^9, 3.598785273439377*^9, 
  3.598785878598909*^9, 3.598787734698057*^9, 3.598789016644932*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Desired Functions", "Subsection",
 CellChangeTimes->{{3.598788037574133*^9, 3.598788039140773*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"stream", "=", 
   RowBox[{"OpenWrite", "[", "\"\<Jdot_foot.mat\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Write", "[", 
   RowBox[{"stream", ",", 
    RowBox[{
     RowBox[{
      SubscriptBox[
       OverscriptBox["J", "."], "foot"], "/.", "consts"}], "/.", 
     "statesubs"}]}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Close", "[", "stream", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "stream", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stream", "=", 
   RowBox[{"OpenWrite", "[", "\"\<Jfoot.mat\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Write", "[", 
   RowBox[{"stream", ",", 
    RowBox[{
     RowBox[{
      SubscriptBox["J", "foot"], "/.", "consts"}], "/.", "statesubs"}]}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Close", "[", "stream", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "stream", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stream", "=", 
   RowBox[{"OpenWrite", "[", "\"\<C.mat\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Write", "[", 
   RowBox[{"stream", ",", 
    RowBox[{
     RowBox[{"\[ScriptCapitalC]", "/.", "consts"}], "/.", "statesubs"}]}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Close", "[", "stream", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "stream", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stream", "=", 
   RowBox[{"OpenWrite", "[", "\"\<D.mat\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Write", "[", 
   RowBox[{"stream", ",", 
    RowBox[{
     RowBox[{"\[ScriptCapitalD]", "/.", "consts"}], "/.", "statesubs"}]}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Close", "[", "stream", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "stream", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stream", "=", 
   RowBox[{"OpenWrite", "[", "\"\<G.mat\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Write", "[", 
   RowBox[{"stream", ",", 
    RowBox[{
     RowBox[{"\[ScriptCapitalG]", "/.", "consts"}], "/.", "statesubs"}]}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Close", "[", "stream", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "stream", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stream", "=", 
   RowBox[{"OpenWrite", "[", "\"\<pCoM.mat\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Write", "[", 
   RowBox[{"stream", ",", 
    RowBox[{
     RowBox[{"pCoM", "/.", "consts"}], "/.", "statesubs"}]}], "]"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Close", "[", "stream", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "stream", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stream", "=", 
   RowBox[{"OpenWrite", "[", "\"\<JCoM.mat\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Write", "[", 
   RowBox[{"stream", ",", 
    RowBox[{
     RowBox[{"JCoM", "/.", "consts"}], "/.", "statesubs"}]}], "]"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Close", "[", "stream", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "stream", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stream", "=", 
   RowBox[{"OpenWrite", "[", "\"\<jpos.mat\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Write", "[", 
   RowBox[{"stream", ",", 
    RowBox[{
     RowBox[{"jpos", "/.", "consts"}], "/.", "statesubs"}]}], "]"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Close", "[", "stream", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "stream", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stream", "=", 
   RowBox[{"OpenWrite", "[", "\"\<footpts.mat\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Write", "[", 
   RowBox[{"stream", ",", 
    RowBox[{
     RowBox[{"footpts", "/.", "consts"}], "/.", "statesubs"}]}], "]"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Close", "[", "stream", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Clear", "[", "stream", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.5963941182254*^9, 3.596394133556162*^9}, {
  3.5963950035788603`*^9, 3.596395004122466*^9}, {3.596395051818131*^9, 
  3.596395052148141*^9}, {3.596457028196075*^9, 3.596457035824383*^9}, {
  3.596821802442442*^9, 3.596821807976935*^9}, {3.597515540251855*^9, 
  3.597515551528202*^9}, {3.597516147563838*^9, 3.597516165552397*^9}, {
  3.598213835877367*^9, 3.598213857888575*^9}, {3.598728332481381*^9, 
  3.598728367850243*^9}, {3.598784876489558*^9, 3.598784907089403*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Run", "[", "\"\<python mathtomat.py\>\"", "]"}]}], "Input",
 CellChangeTimes->{{3.597516202026517*^9, 3.597516211342989*^9}, {
  3.597516307556871*^9, 3.597516308834833*^9}, {3.597516380729245*^9, 
  3.597516381952361*^9}}],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{
  3.597516213437347*^9, 3.597516314164084*^9, 3.597516345661529*^9, {
   3.597516384511484*^9, 3.597516398407772*^9}, 3.597688583957014*^9, 
   3.597870772831726*^9, 3.5978711925971737`*^9, 3.598032738706573*^9, 
   3.598033786082725*^9, 3.598034744177031*^9, 3.598034937134742*^9, 
   3.59803532402459*^9, 3.5980398996531343`*^9, 3.5980939722501583`*^9, 
   3.5980947599985247`*^9, {3.598094809473687*^9, 3.598094825269968*^9}, 
   3.5981162571502457`*^9, 3.5982136607170963`*^9, {3.598213864489381*^9, 
   3.598213893794245*^9}, 3.598716055106456*^9, 3.59871621747296*^9, 
   3.5987166397506657`*^9, 3.598716749613618*^9, 3.598718573926609*^9, 
   3.5987187591384974`*^9, 3.5987192885866957`*^9, 3.598720351962282*^9, 
   3.5987207959591084`*^9, 3.59872256466011*^9, 3.5987247706741333`*^9, 
   3.59872563512856*^9, 3.598726981994083*^9, 3.5987284306214533`*^9, 
   3.598732926055496*^9, 3.5987811066003304`*^9, 3.598784849433445*^9, 
   3.598785273694016*^9, 3.5987858788456078`*^9, 3.598787735697289*^9, 
   3.5987890171657343`*^9}]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.5987162719576797`*^9, 3.598716272976054*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1855, 1176},
WindowMargins->{{-9, Automatic}, {Automatic, 0}},
FrontEndVersion->"9.0 for Linux x86 (64-bit) (February 7, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 174, 5, 117, "Section"],
Cell[CellGroupData[{
Cell[778, 31, 171, 3, 45, "Subsection"],
Cell[952, 36, 483, 9, 91, "Text"],
Cell[1438, 47, 310, 6, 32, "Input"],
Cell[CellGroupData[{
Cell[1773, 57, 103, 1, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[1901, 62, 208, 3, 30, "Item"],
Cell[2112, 67, 249, 4, 30, "Item"],
Cell[2364, 73, 219, 5, 30, "Item"],
Cell[2586, 80, 211, 3, 30, "Item"],
Cell[2800, 85, 357, 10, 30, "Item"],
Cell[3160, 97, 405, 10, 30, "Item"],
Cell[3568, 109, 496, 12, 30, "Item"],
Cell[4067, 123, 465, 11, 32, "Item"],
Cell[4535, 136, 496, 12, 30, "Item"],
Cell[5034, 150, 362, 10, 30, "Item"],
Cell[5399, 162, 365, 10, 30, "Item"],
Cell[5767, 174, 365, 10, 30, "Item"]
}, Open  ]]
}, Open  ]],
Cell[6159, 188, 114, 1, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[6298, 193, 114, 1, 29, "Subsubsection"],
Cell[6415, 196, 921, 22, 32, "Input"],
Cell[7339, 220, 457, 12, 32, "Input"],
Cell[7799, 234, 197, 4, 32, "Input"],
Cell[7999, 240, 1977, 40, 101, "Input"],
Cell[9979, 282, 195, 5, 32, "Input"],
Cell[10177, 289, 6326, 173, 221, "Input"],
Cell[CellGroupData[{
Cell[16528, 466, 100, 1, 32, "Input"],
Cell[16631, 469, 3279, 97, 57, "Output"]
}, Open  ]],
Cell[19925, 569, 5396, 152, 310, "Input"],
Cell[25324, 723, 2569, 78, 191, "Input"],
Cell[27896, 803, 6576, 201, 126, "Input"],
Cell[34475, 1006, 6979, 191, 173, "Input"],
Cell[41457, 1199, 950, 25, 32, "Input"],
Cell[42410, 1226, 717, 19, 32, "Input"],
Cell[43130, 1247, 782, 20, 67, "Input"],
Cell[43915, 1269, 317, 9, 34, "Input"],
Cell[44235, 1280, 7618, 212, 173, "Input"],
Cell[51856, 1494, 1973, 53, 121, "Input"],
Cell[53832, 1549, 1246, 32, 32, "Input"],
Cell[55081, 1583, 450, 13, 32, "Input"],
Cell[CellGroupData[{
Cell[55556, 1600, 98, 1, 32, "Input"],
Cell[55657, 1603, 1230, 35, 34, "Output"]
}, Open  ]],
Cell[56902, 1641, 708, 16, 65, "Input"],
Cell[57613, 1659, 825, 20, 65, "Input"],
Cell[58441, 1681, 638, 14, 34, "Input"],
Cell[59082, 1697, 650, 13, 37, "Input"],
Cell[59735, 1712, 665, 15, 99, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[60449, 1733, 137, 3, 45, "Subsection"],
Cell[60589, 1738, 515, 12, 32, "Input"],
Cell[61107, 1752, 314, 8, 32, "Input"],
Cell[61424, 1762, 260, 7, 32, "Input"],
Cell[61687, 1771, 533, 14, 32, "Input"],
Cell[62223, 1787, 858, 26, 70, "Input"],
Cell[CellGroupData[{
Cell[63106, 1817, 150, 3, 32, "Input"],
Cell[63259, 1822, 3147, 90, 146, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[66455, 1918, 105, 1, 45, "Subsection"],
Cell[66563, 1921, 4692, 143, 982, "Input"],
Cell[CellGroupData[{
Cell[71280, 2068, 375, 8, 55, "Input"],
Cell[71658, 2078, 1085, 16, 32, "Output"]
}, Open  ]],
Cell[72758, 2097, 94, 1, 32, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
